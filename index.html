<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>é‰…åŸå¨›æ¨‚ - æˆ°ç¥å¡ç‰¹ãƒ»è±ªè¯é«”é©—</title>
  <meta name="description" content="é‰…åŸå¨›æ¨‚ - é ‚ç´šéŠæˆ²é«”é©—ï¼Œé™æ™‚è±ªè¯å°ˆå±¬ç¦®é‡">
  <meta name="theme-color" content="#000000">
  
  <!-- Open Graph Meta Tags -->
  <meta property="og:title" content="é‰…åŸå¨›æ¨‚ - æˆ°ç¥å¡ç‰¹ãƒ»è±ªè¯é«”é©—" />
  <meta property="og:description" content="é™æ™‚è±ªè¯å°ˆå±¬ç¦®é‡ï¼Œåƒå…ƒå¥½ç¦®ç«‹å³åˆ°æ‰‹ï¼VIPå°ˆå±¬å„ªæƒ ï¼Œåé¡æœ‰é™ã€‚" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="images/æˆ°ç¥å¡ç‰¹.png" />
  
  <!-- Preconnect for Performance -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://connect.facebook.net">
  
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  
  <!-- Meta Pixel Code -->
  <script>
  !function(f,b,e,v,n,t,s)
  {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
  n.callMethod.apply(n,arguments):n.queue.push(arguments)};
  if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
  n.queue=[];t=b.createElement(e);t.async=!0;
  t.src=v;s=b.getElementsByTagName(e)[0];
  s.parentNode.insertBefore(t,s)}(window, document,'script',
  'https://connect.facebook.net/en_US/fbevents.js');
  fbq('init', '997407415711331');
  fbq('track', 'PageView');
  </script>
  <noscript><img height="1" width="1" style="display:none"
  src="https://www.facebook.com/tr?id=997407415711331&ev=PageView&noscript=1"
  /></noscript>
  <!-- End Meta Pixel Code -->

  <style>
    /* CSS è®Šæ•¸å®šç¾© */
    :root {
      --primary-gold: #FFD700;
      --dark-gold: #B8860B;
      --light-gold: #FFDF7F;
      --black: #000000;
      --dark-gray: #1A1A1A;
      --white: #FFFFFF;
      --line-green: #06C755;
      --accent-red: #FF4136;
      --shadow-gold: rgba(255, 215, 0, 0.3);
      --shadow-green: rgba(6, 199, 85, 0.4);
    }
    
    /* åŸºç¤é‡ç½®å’Œè¨­å®š */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    html {
      scroll-behavior: smooth;
      font-size: 16px;
    }
    
    body {
      font-family: 'Noto Sans TC', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: var(--black);
      color: var(--white);
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      overflow-x: hidden;
    }
    
    /* å®¹å™¨å’ŒèƒŒæ™¯ */
    .main-container {
      position: relative;
      min-height: 100vh;
      background: linear-gradient(135deg, #000000 0%, #1C1500 50%, #2A1F00 100%);
    }
    
    .bg-pattern {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      opacity: 0.15;
      background-image: radial-gradient(var(--primary-gold) 1px, transparent 1px);
      background-size: 50px 50px;
      animation: float 20s ease-in-out infinite;
      pointer-events: none;
      z-index: 1;
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-20px); }
    }
    
    /* å°èˆªåˆ— */
    .navbar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1000;
      background: rgba(0, 0, 0, 0.9);
      backdrop-filter: blur(10px);
      padding: 1rem 2rem;
      transition: transform 0.3s ease;
    }
    
    .navbar.hide {
      transform: translateY(-100%);
    }
    
    .nav-content {
      display: flex;
      justify-content: center;
      align-items: center;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .logo {
      height: 60px;
      transition: transform 0.3s ease;
    }
    
    .logo:hover {
      transform: scale(1.05);
    }
    
    /* ä¸»è¦å…§å®¹å€åŸŸ */
    .hero-section {
      position: relative;
      z-index: 2;
      min-height: 100vh;
      display: flex;
      align-items: center;
      padding: 120px 2rem 60px;
    }
    
    .hero-container {
      max-width: 1200px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 4rem;
      align-items: center;
    }
    
    /* åœ–ç‰‡å€åŸŸ */
    .image-section {
      display: flex;
      justify-content: center;
      align-items: center;
    }
    
    .image-frame {
      position: relative;
      border-radius: 20px;
      overflow: hidden;
      border: 3px solid var(--primary-gold);
      box-shadow: 0 0 30px var(--shadow-gold);
      transition: all 0.5s ease;
      max-width: 100%;
    }
    
    .image-frame:hover {
      transform: scale(1.05) rotate(-2deg);
      box-shadow: 0 0 50px var(--shadow-gold);
    }
    
    .character-image {
      width: 100%;
      height: auto;
      display: block;
      transition: transform 0.5s ease;
    }
    
    .image-frame:hover .character-image {
      transform: scale(1.1);
    }
    
    /* æ–‡å­—å…§å®¹å€åŸŸ */
    .content-section {
      padding: 2rem 0;
    }
    
    .main-title {
      font-size: 3.5rem;
      font-weight: 900;
      color: var(--primary-gold);
      text-shadow: 
        0 2px 4px rgba(0,0,0,0.5),
        0 0 8px rgba(255, 215, 0, 0.3);
      margin-bottom: 1rem;
      line-height: 1.1;
    }
    
    .sub-title {
      font-size: 2rem;
      font-weight: 700;
      color: var(--white);
      margin-bottom: 2rem;
      text-shadow: 0 2px 4px rgba(0,0,0,0.5);
    }
    
    .promo-text {
      font-size: 1.4rem;
      font-weight: 600;
      color: var(--light-gold);
      margin-bottom: 1rem;
    }
    
    .promo-details {
      font-size: 1.2rem;
      color: rgba(255,255,255,0.9);
      margin-bottom: 2.5rem;
    }
    
    /* æ­¥é©Ÿèªªæ˜ */
    .steps-list {
      margin-bottom: 3rem;
    }
    
    .step-item {
      display: flex;
      align-items: center;
      margin-bottom: 1.5rem;
      font-size: 1.1rem;
    }
    
    .step-number {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      background: var(--primary-gold);
      color: var(--black);
      font-weight: bold;
      border-radius: 50%;
      margin-right: 1rem;
      flex-shrink: 0;
    }
    
    /* CTA æŒ‰éˆ• */
    .cta-wrapper {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    
    .cta-button {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: var(--line-green);
      color: var(--white);
      text-decoration: none;
      font-weight: 700;
      font-size: 1.5rem;
      padding: 1.2rem 2rem;
      border-radius: 50px;
      position: relative;
      overflow: hidden;
      box-shadow: 0 8px 25px var(--shadow-green);
      transition: all 0.3s ease;
      border: 2px solid var(--line-green);
      min-height: 70px;
      cursor: pointer;
    }
    
    .cta-button:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 35px var(--shadow-green);
      background: #05b84d;
    }
    
    .cta-button:active {
      transform: translateY(-1px);
    }
    
    .cta-button:disabled {
      opacity: 0.7;
      cursor: not-allowed;
      transform: none;
    }
    
    .cta-button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: 0.5s;
    }
    
    .cta-button:hover::before {
      left: 100%;
    }
    
    .line-icon {
      margin-right: 0.8rem;
      font-size: 1.8rem;
    }
    
    /* é è…³ */
    .footer {
      background: rgba(0,0,0,0.9);
      padding: 3rem 2rem 2rem;
      text-align: center;
      border-top: 1px solid rgba(255,215,0,0.2);
    }
    
    .footer-logo {
      height: 40px;
      margin-bottom: 1.5rem;
      opacity: 0.8;
    }
    
    .copyright {
      color: rgba(255,255,255,0.6);
      font-size: 0.9rem;
    }
    
    /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
    @media (max-width: 1024px) {
      .hero-container {
        grid-template-columns: 1fr;
        gap: 3rem;
      }
      
      .main-title {
        font-size: 3rem;
      }
      
      .sub-title {
        font-size: 1.8rem;
      }
    }
    
    @media (max-width: 768px) {
      .hero-section {
        padding: 100px 1rem 40px;
      }
      
      .main-title {
        font-size: 2.5rem;
        text-align: center;
      }
      
      .sub-title {
        font-size: 1.5rem;
        text-align: center;
      }
      
      .content-section {
        text-align: center;
        padding: 1rem 0;
      }
      
      .cta-button {
        font-size: 1.3rem;
        padding: 1rem 1.5rem;
      }
      
      .navbar {
        padding: 0.8rem 1rem;
      }
      
      .logo {
        height: 50px;
      }
    }
    
    @media (max-width: 480px) {
      .main-title {
        font-size: 2rem;
      }
      
      .sub-title {
        font-size: 1.3rem;
      }
      
      .promo-text {
        font-size: 1.2rem;
      }
      
      .promo-details {
        font-size: 1rem;
      }
      
      .step-item {
        font-size: 1rem;
      }
      
      .cta-button {
        font-size: 1.2rem;
        padding: 0.9rem 1.2rem;
        min-height: 60px;
      }
      
      .line-icon {
        font-size: 1.5rem;
        margin-right: 0.6rem;
      }
    }
    
    /* è¼‰å…¥å‹•ç•« */
    .fade-in {
      animation: fadeInUp 1s ease-out;
    }
    
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    /* æŒ‰éˆ•é»æ“Šæ•ˆæœ */
    .click-effect {
      position: relative;
      overflow: hidden;
    }
    
    .click-effect::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255,255,255,0.3);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }
    
    .click-effect.clicked::after {
      width: 300px;
      height: 300px;
    }
  </style>
</head>

<body>
  <div class="main-container">
    <!-- èƒŒæ™¯åœ–æ¡ˆ -->
    <div class="bg-pattern"></div>
    
    <!-- å°èˆªåˆ— -->
    <nav class="navbar" id="navbar">
      <div class="nav-content">
        <img src="images/logo.png" alt="é‰…åŸå¨›æ¨‚" class="logo">
      </div>
    </nav>
    
    <!-- ä¸»è¦å…§å®¹ -->
    <main class="hero-section">
      <div class="hero-container">
        <!-- åœ–ç‰‡å€åŸŸ -->
        <div class="image-section fade-in">
          <div class="image-frame">
            <img src="images/æˆ°ç¥å¡ç‰¹.png" alt="æˆ°ç¥å¡ç‰¹" class="character-image">
          </div>
        </div>
        
        <!-- æ–‡å­—å…§å®¹å€åŸŸ -->
        <div class="content-section fade-in">
          <h1 class="main-title">æˆ°ç¥å¡ç‰¹ x é‰…åŸå¨›æ¨‚</h1>
          <h2 class="sub-title">æ¥µè‡´é«”é©—ãƒ»è±ªè¯ç››å®´</h2>
          
          <p class="promo-text">ğŸ‰ é™æ™‚è±ªè¯å°ˆå±¬ç¦®é‡ï¼Œåƒå…ƒå¥½ç¦®ç«‹å³åˆ°æ‰‹ï¼</p>
          <p class="promo-details">VIPå°ˆå±¬å„ªæƒ ï¼Œåé¡æœ‰é™ï¼Œå…ˆåˆ°å…ˆå¾—ï¼ç«‹å³è¡Œå‹•ï¼Œæ¶ä½”å…ˆæ©Ÿï¼</p>
          
          <div class="steps-list">
            <div class="step-item">
              <div class="step-number">1</div>
              <div>åŠ å…¥å®˜æ–¹LINE - å°ˆå±¬ç¾å¥³å°åŠ©æ‰‹æœå‹™</div>
            </div>
            <div class="step-item">
              <div class="step-number">2</div>
              <div>å®Œæˆè¨»å†Š - æš¢äº«æ¥µè‡´éŠæˆ²é«”é©—</div>
            </div>
            <div class="step-item">
              <div class="step-number">3</div>
              <div>ç«‹å³é ˜å– - å¤šé‡è±ªè¯å¥½ç¦®ç­‰æ‚¨æ‹¿</div>
            </div>
          </div>
          
          <div class="cta-wrapper">
            <button 
               id="joinLineBtn" 
               class="cta-button click-effect"
               type="button"
               data-event="registration">
              <i class="fab fa-line line-icon"></i>
              ç«‹å³åŠ å…¥å®˜æ–¹LINE
            </button>
          </div>
        </div>
      </div>
    </main>
    
    <!-- é è…³ -->
    <footer class="footer">
      <img src="images/logo.png" alt="é‰…åŸå¨›æ¨‚" class="footer-logo">
      <p class="copyright">Â© 2025 é‰…åŸå¨›æ¨‚. All Rights Reserved. | å°ˆæ¥­ç·šä¸ŠéŠæˆ²å¹³å°</p>
    </footer>
  </div>

  <script>
    // å…¨åŸŸè®Šæ•¸
    let pixelReady = false;
    let userInteractions = {
      pageLoadTime: Date.now(),
      maxScrollDepth: 0,
      buttonVisible: false,
      buttonClicked: false
    };

    // Facebook Pixel ç‹€æ…‹æª¢æŸ¥
    function checkPixelStatus() {
      return new Promise((resolve) => {
        let attempts = 0;
        const maxAttempts = 20;
        
        function check() {
          attempts++;
          
          if (typeof fbq !== 'undefined' && fbq.loaded) {
            pixelReady = true;
            console.log('âœ… Facebook Pixel loaded successfully');
            resolve(true);
          } else if (attempts < maxAttempts) {
            setTimeout(check, 250);
          } else {
            console.warn('âš ï¸ Facebook Pixel failed to load');
            resolve(false);
          }
        }
        
        check();
      });
    }

    // å®‰å…¨çš„ Facebook Pixel äº‹ä»¶ç™¼é€
    function sendPixelEvent(eventName, parameters = {}, callback = null) {
      if (!pixelReady || typeof fbq === 'undefined') {
        console.warn(`âŒ Cannot send ${eventName} - Pixel not ready`);
        if (callback) callback();
        return;
      }

      try {
        console.log(`ğŸ“Š Sending Facebook Pixel event: ${eventName}`, parameters);
        
        if (eventName.startsWith('track')) {
          fbq(eventName, parameters);
        } else {
          fbq('trackCustom', eventName, parameters);
        }
        
        if (callback) {
          setTimeout(callback, 100);
        }
        
      } catch (error) {
        console.error(`âŒ Error sending ${eventName}:`, error);
        if (callback) callback();
      }
    }

    // ä¸»è¦ CTA æŒ‰éˆ•é»æ“Šè™•ç†
    function handleCTAClick() {
      if (userInteractions.buttonClicked) {
        console.log('Button already clicked, preventing double-click');
        return;
      }
      
      userInteractions.buttonClicked = true;
      const button = document.getElementById('joinLineBtn');
      
      if (!button) return;
      
      // ç¦ç”¨æŒ‰éˆ•é˜²æ­¢é‡è¤‡é»æ“Š
      button.disabled = true;
      button.style.opacity = '0.8';
      
      console.log('ğŸ¯ CTA Button clicked - Starting event tracking...');
      
      // äº‹ä»¶ç™¼é€éšŠåˆ—
      const events = [
        {
          name: 'Lead',
          params: {
            content_name: 'LINEå®˜æ–¹å¸³è™ŸåŠ å…¥',
            content_category: 'å®¢æˆ¶é–‹ç™¼',
            source: 'æˆ°ç¥å¡ç‰¹è½åœ°é '
          }
        },
        {
          name: 'CompleteRegistration',
          params: {
            content_name: 'æˆ°ç¥å¡ç‰¹éŠæˆ²è¨»å†Š',
            content_category: 'ç·šä¸ŠéŠæˆ²',
            content_type: 'signup',
            value: 1000,
            currency: 'TWD'
          }
        },
        {
          name: 'LineButtonClick',
          params: {
            content_name: 'æˆ°ç¥å¡ç‰¹LINEæŒ‰éˆ•',
            button_text: 'ç«‹å³åŠ å…¥å®˜æ–¹LINE',
            page_location: window.location.href
          }
        }
      ];
      
      // ç™¼é€æ‰€æœ‰äº‹ä»¶
      let eventsSent = 0;
      const totalEvents = events.length;
      
      function sendNextEvent() {
        if (eventsSent >= totalEvents) {
          // æ‰€æœ‰äº‹ä»¶ç™¼é€å®Œæˆï¼ŒåŸ·è¡Œè·³è½‰
          setTimeout(() => {
            console.log('ğŸš€ All events sent, redirecting to LINE...');
            window.open('https://lin.ee/WQfGz0J', '_blank');
            
            // æ¢å¾©æŒ‰éˆ•ç‹€æ…‹
            setTimeout(() => {
              button.disabled = false;
              button.style.opacity = '1';
              userInteractions.buttonClicked = false;
            }, 2000);
          }, 200);
          return;
        }
        
        const event = events[eventsSent];
        sendPixelEvent(event.name, event.params, () => {
          eventsSent++;
          sendNextEvent();
        });
      }
      
      // é–‹å§‹ç™¼é€äº‹ä»¶
      sendNextEvent();
      
      // å‚™ç”¨è¶…æ™‚æ©Ÿåˆ¶ - ç¢ºä¿å³ä½¿äº‹ä»¶å¤±æ•—ä¹Ÿæœƒè·³è½‰
      setTimeout(() => {
        if (button.disabled) {
          console.log('â° Timeout reached, forcing redirect...');
          window.open('https://lin.ee/WQfGz0J', '_blank');
          button.disabled = false;
          button.style.opacity = '1';
          userInteractions.buttonClicked = false;
        }
      }, 3000);
    }

    // åˆå§‹åŒ–å‡½æ•¸
    async function initializePixelTracking() {
      console.log('ğŸš€ Initializing Facebook Pixel tracking...');
      
      // ç­‰å¾… Pixel è¼‰å…¥
      await checkPixelStatus();
      
      if (pixelReady) {
        // ç™¼é€é é¢è¼‰å…¥äº‹ä»¶
        sendPixelEvent('PageLoaded', {
          page_name: 'æˆ°ç¥å¡ç‰¹éŠæˆ²é é¢',
          content_category: 'éŠæˆ²æ¨å»£',
          user_agent: navigator.userAgent,
          referrer: document.referrer || 'direct'
        });
        
        // è¨­ç½®æŒ‰éˆ•å¯è¦‹æ€§è¿½è¸ª
        setupButtonVisibilityTracking();
        
        // è¨­ç½®æ»¾å‹•æ·±åº¦è¿½è¸ª
        setupScrollTracking();
        
        console.log('âœ… Pixel tracking initialized successfully');
      }
    }

    // æŒ‰éˆ•å¯è¦‹æ€§è¿½è¸ª
    function setupButtonVisibilityTracking() {
      const ctaButton = document.getElementById('joinLineBtn');
      if (!ctaButton) return;
      
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting && !userInteractions.buttonVisible) {
            userInteractions.buttonVisible = true;
            
            sendPixelEvent('ViewContent', {
              content_name: 'æˆ°ç¥å¡ç‰¹CTAæŒ‰éˆ•',
              content_type: 'button',
              content_category: 'éŠæˆ²è¨»å†Š'
            });
            
            // åªè¿½è¸ªä¸€æ¬¡ï¼Œæ‰€ä»¥ç§»é™¤è§€å¯Ÿ
            observer.unobserve(entry.target);
          }
        });
      }, { 
        threshold: 0.5,
        rootMargin: '0px 0px -50px 0px'
      });
      
      observer.observe(ctaButton);
    }

    // æ»¾å‹•æ·±åº¦è¿½è¸ª
    function setupScrollTracking() {
      let scrollTimer;
      
      window.addEventListener('scroll', () => {
        clearTimeout(scrollTimer);
        scrollTimer = setTimeout(() => {
          const scrollPercent = Math.round(
            (window.scrollY / (document.documentElement.scrollHeight - window.innerHeight)) * 100
          );
          
          if (scrollPercent > userInteractions.maxScrollDepth) {
            userInteractions.maxScrollDepth = scrollPercent;
            
            // è¿½è¸ªé‡è¦çš„æ»¾å‹•é‡Œç¨‹ç¢‘
            if (scrollPercent >= 25 && scrollPercent < 30) {
              sendPixelEvent('ScrollDepth25', { scroll_depth: scrollPercent });
            } else if (scrollPercent >= 50 && scrollPercent < 55) {
              sendPixelEvent('ScrollDepth50', { scroll_depth: scrollPercent });
            } else if (scrollPercent >= 75 && scrollPercent < 80) {
              sendPixelEvent('ScrollDepth75', { scroll_depth: scrollPercent });
            } else if (scrollPercent >= 90 && scrollPercent < 95) {
              sendPixelEvent('ScrollDepth90', { scroll_depth: scrollPercent });
            }
          }
        }, 250);
      });
    }

    // DOM è¼‰å…¥å®Œæˆå¾ŒåŸ·è¡Œ
    document.addEventListener('DOMContentLoaded', function() {
      console.log('ğŸ“„ DOM Content Loaded');
      
      // åˆå§‹åŒ– Pixel è¿½è¸ª
      initializePixelTracking();
      
      // è¨­ç½®æŒ‰éˆ•é»æ“Šäº‹ä»¶
      const joinLineBtn = document.getElementById('joinLineBtn');
      if (joinLineBtn) {
        joinLineBtn.addEventListener('click', function(e) {
          e.preventDefault();
          
          // æ·»åŠ è¦–è¦ºæ•ˆæœ
          this.classList.add('clicked');
          setTimeout(() => {
            this.classList.remove('clicked');
          }, 600);
          
          // åŸ·è¡Œäº‹ä»¶è¿½è¸ªå’Œè·³è½‰
          handleCTAClick();
        });
      }
      
      // å°èˆªåˆ—æ»¾å‹•æ•ˆæœ
      setupNavbarScrollEffect();
      
      // åœ–ç‰‡æ‡¶è¼‰å…¥
      setupImageLazyLoading();
      
      console.log('âœ… Page initialization complete');
    });

    // å°èˆªåˆ—æ»¾å‹•æ•ˆæœ
    function setupNavbarScrollEffect() {
      let lastScrollY = window.scrollY;
      const navbar = document.getElementById('navbar');
      let scrollTimer;
      
      function handleScroll() {
        const currentScrollY = window.scrollY;
        
        if (currentScrollY > 100) {
          if (currentScrollY > lastScrollY) {
            navbar.classList.add('hide');
          } else {
            navbar.classList.remove('hide');
          }
        } else {
          navbar.classList.remove('hide');
        }
        
        lastScrollY = currentScrollY;
      }
      
      window.addEventListener('scroll', function() {
        clearTimeout(scrollTimer);
        scrollTimer = setTimeout(handleScroll, 10);
      });
    }

    // åœ–ç‰‡æ‡¶è¼‰å…¥
    function setupImageLazyLoading() {
      const images = document.querySelectorAll('img');
      images.forEach(img => {
        img.loading = 'lazy';
      });
    }

    // é é¢é›¢é–‹å‰çš„äº‹ä»¶è¿½è¸ª
    window.addEventListener('beforeunload', function() {
      if (pixelReady) {
        const timeSpent = Math.round((Date.now() - userInteractions.pageLoadTime) / 1000);
        
        if (timeSpent > 5) {
          sendPixelEvent('PageEngagement', {
            time_spent: timeSpent,
            max_scroll_depth: userInteractions.maxScrollDepth,
            button_clicked: userInteractions.buttonClicked,
            engagement_level: timeSpent > 30 ? 'high' : timeSpent > 10 ? 'medium' : 'low'
          });
        }
      }
    });

    // å…¨åŸŸéŒ¯èª¤è™•ç†
    window.addEventListener('error', function(e) {
      console.error('ğŸ’¥ Page error:', e.error);
      
      if (pixelReady) {
        sendPixelEvent('PageError', {
          error_message: e.message || 'Unknown error',
          error_source: e.filename || 'Unknown source',
          error_line: e.lineno || 0
        });
      }
    });

    // æœ€çµ‚æª¢æŸ¥ - ç¢ºä¿ Pixel æ­£å¸¸å·¥ä½œ
    window.addEventListener('load', function() {
      setTimeout(() => {
        if (pixelReady) {
          console.log('ğŸ‰ All systems ready - Facebook Pixel tracking active');
          
          // ç™¼é€æ¸¬è©¦äº‹ä»¶ç¢ºèªä¸€åˆ‡æ­£å¸¸
          sendPixelEvent('SystemReady', {
            status: 'active',
            timestamp: Date.now(),
            user_agent: navigator.userAgent.substring(0, 100)
          });
          
        } else {
          console.error('âŒ Facebook Pixel failed to initialize properly');
        }
      }, 2000);
    });
  </script>
</body>
</html>
